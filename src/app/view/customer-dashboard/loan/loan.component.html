<!-- Page Header -->
<div class="mb-8 animate-fade-in">
  <h1 class="text-4xl font-bold text-white mb-2">Loans</h1>
  <p class="text-white/70">Apply for loans and manage your existing loans</p>
</div>

<!-- Alert for no fixed deposits -->
<div *ngIf="!fds || fds.length === 0" class="animate-slide-up">
  <div class="glass-card p-6 border-l-4 border-red-500/50">
    <div class="flex items-start gap-4">
      <div class="flex-shrink-0">
        <i class="fas fa-exclamation-circle text-red-400 text-3xl"></i>
      </div>
      <div class="flex-1">
        <h3 class="text-xl font-bold text-white mb-2">No Fixed Deposit Found</h3>
        <p class="text-white/70">
          You can't apply for an online loan because you don't have any fixed deposit. If you want to apply for a loan, you need to have a fixed deposit.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div *ngIf="fds && fds.length != 0">
  <!-- Apply for Loan Form -->
  <div class="glass-card p-6 mb-8 animate-slide-up">
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-white mb-1 flex items-center">
        <i class="fas fa-hand-holding-usd mr-3 text-glass-cyan"></i>
        Apply for a Loan
      </h2>
      <p class="text-white/60 text-sm">Fill out the form to request a loan</p>
    </div>

    <form class="space-y-6">
      <!-- Fixed Deposit Selection -->
      <div>
        <label class="block text-white/80 text-sm font-medium mb-2">
          Choose a Fixed Deposit <span class="text-red-400">*</span>
        </label>
        <div class="relative">
          <i class="fas fa-piggy-bank absolute left-4 top-1/2 transform -translate-y-1/2 text-white/50 z-10"></i>
          <select
            class="glass-input pl-12 appearance-none cursor-pointer"
            [(ngModel)]="selectedFD"
            (change)="onFDSelected()"
            name="selectedFD"
          >
            <option [ngValue]="null" disabled selected>Select a fixed deposit</option>
            <option *ngFor="let account of fds" [ngValue]="account">
              FD ID: {{ account.fd_id }} | Duration: {{ convertDuration(account.duration) }} | Amount: Rs. {{ account.amount | number }}
            </option>
          </select>
          <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-white/50 pointer-events-none"></i>
        </div>
      </div>

      <!-- Loan Amount -->
      <div>
        <label class="block text-white/80 text-sm font-medium mb-2">
          Loan Amount <span class="text-red-400">*</span>
        </label>
        <p class="text-white/50 text-xs mb-2" *ngIf="maximumLoanAmount">
          <i class="fas fa-info-circle mr-1"></i>
          Maximum amount: Rs. {{ maximumLoanAmount | number }}
        </p>
        <div class="relative">
          <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/50">Rs.</span>
          <input
            type="number"
            class="glass-input pl-14"
            placeholder="Enter loan amount"
            [(ngModel)]="loanAmount"
            name="loanAmount"
            (ngModelChange)="checkLoanAmount()"
          />
        </div>
      </div>

      <!-- Loan Package Selection -->
      <div>
        <label class="block text-white/80 text-sm font-medium mb-2">
          Select Loan Payment Plan <span class="text-red-400">*</span>
        </label>
        <div class="relative">
          <i class="fas fa-calendar-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-white/50 z-10"></i>
          <select
            class="glass-input pl-12 appearance-none cursor-pointer"
            [(ngModel)]="selectedLoan"
            (ngModelChange)="onLoanSelected()"
            name="selectedPackage"
          >
            <option value="" disabled selected>Select a payment plan</option>
            <option *ngFor="let package of packageArray" [value]="package.index">
              Package {{ package.index }} | Duration: {{ package.period }} | Interest Rate: {{ package.interest }}%
            </option>
          </select>
          <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-white/50 pointer-events-none"></i>
        </div>
      </div>

      <!-- Loan Type Selection -->
      <div>
        <label class="block text-white/80 text-sm font-medium mb-3">
          Select Loan Type <span class="text-red-400">*</span>
        </label>
        <div class="flex gap-4">
          <label class="flex-1 cursor-pointer">
            <input
              type="radio"
              [(ngModel)]="selectedLoanType"
              name="loanType"
              value="Personal"
              class="hidden peer"
            />
            <div class="p-4 rounded-xl backdrop-blur-md bg-white/5 border-2 border-white/10 transition-all duration-300 peer-checked:border-glass-purple peer-checked:bg-white/10">
              <div class="flex items-center gap-3">
                <i class="fas fa-user text-glass-purple text-2xl"></i>
                <div>
                  <div class="text-white font-semibold">Personal</div>
                  <div class="text-white/60 text-xs">For personal use</div>
                </div>
              </div>
            </div>
          </label>

          <label class="flex-1 cursor-pointer">
            <input
              type="radio"
              [(ngModel)]="selectedLoanType"
              name="loanType"
              value="Business"
              class="hidden peer"
            />
            <div class="p-4 rounded-xl backdrop-blur-md bg-white/5 border-2 border-white/10 transition-all duration-300 peer-checked:border-glass-cyan peer-checked:bg-white/10">
              <div class="flex items-center gap-3">
                <i class="fas fa-briefcase text-glass-cyan text-2xl"></i>
                <div>
                  <div class="text-white font-semibold">Business</div>
                  <div class="text-white/60 text-xs">For business purposes</div>
                </div>
              </div>
            </div>
          </label>
        </div>
      </div>

      <!-- Submit Button -->
      <button
        type="button"
        class="glass-button w-full md:w-auto justify-center"
        (click)="proceed()"
        [disabled]="!selectedFD || !loanAmount || !selectedLoan || !selectedLoanType"
        [class.opacity-50]="!selectedFD || !loanAmount || !selectedLoan || !selectedLoanType"
        [class.cursor-not-allowed]="!selectedFD || !loanAmount || !selectedLoan || !selectedLoanType"
      >
        <i class="fas fa-check-circle mr-2"></i>
        Submit Loan Application
      </button>
    </form>
  </div>
</div>

<!-- Previous Loans Table -->
<div class="glass-card p-6 animate-slide-up" style="animation-delay: 0.2s;">
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-white mb-1 flex items-center">
      <i class="fas fa-history mr-3 text-glass-pink"></i>
      Your Loans
    </h2>
    <p class="text-white/60 text-sm">View all your loan applications and history</p>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead>
        <tr>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">
            <i class="fas fa-hashtag mr-2"></i>#
          </th>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">Loan ID</th>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">Amount</th>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">Starting Date</th>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">Duration</th>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">Interest</th>
          <th class="text-left px-6 py-4 text-white/80 font-semibold text-sm uppercase tracking-wider">Type</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let loan of loans; let i = index"
          class="transition-all duration-300 hover:bg-white/5"
        >
          <td class="px-6 py-4 text-white/90 font-mono">{{ i + 1 }}</td>
          <td class="px-6 py-4">
            <span class="glass-badge bg-gradient-to-r from-glass-purple/80 to-glass-blue/80">
              <i class="fas fa-fingerprint mr-1"></i>
              {{ loan.loan_basic_detail_id }}
            </span>
          </td>
          <td class="px-6 py-4">
            <span class="text-white font-semibold text-lg">
              Rs. {{ loan.amount | number }}
            </span>
          </td>
          <td class="px-6 py-4 text-white/90">
            <i class="far fa-calendar mr-2 text-glass-cyan"></i>
            {{ loan.starting_date | date: 'yyyy-MM-dd' }}
          </td>
          <td class="px-6 py-4">
            <span class="glass-badge bg-gradient-to-r from-glass-emerald/80 to-glass-cyan/80">
              <i class="far fa-clock mr-1"></i>
              {{ loan.duration_days }} days
            </span>
          </td>
          <td class="px-6 py-4">
            <span class="text-glass-orange font-semibold">
              <i class="fas fa-percentage mr-1"></i>
              {{ loan.interest }}%
            </span>
          </td>
          <td class="px-6 py-4">
            <span
              class="glass-badge"
              [ngClass]="{
                'bg-gradient-to-r from-glass-purple/80 to-glass-pink/80': loan.loan_type === 'Personal',
                'bg-gradient-to-r from-glass-cyan/80 to-glass-blue/80': loan.loan_type === 'Business'
              }"
            >
              <i
                [ngClass]="{
                  'fas fa-user': loan.loan_type === 'Personal',
                  'fas fa-briefcase': loan.loan_type === 'Business'
                }"
                class="mr-1"
              ></i>
              {{ loan.loan_type }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="!loans || loans.length === 0" class="text-center py-12">
      <div class="text-6xl text-white/20 mb-4">
        <i class="fas fa-hand-holding-usd"></i>
      </div>
      <p class="text-white/60">No loans found</p>
      <p class="text-white/40 text-sm mt-2">Apply for your first loan to get started</p>
    </div>
  </div>
</div>
